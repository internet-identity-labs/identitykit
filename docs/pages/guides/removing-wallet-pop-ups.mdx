---
title: "Remove Wallet Pop-ups"
date: "2024-07-10"
authors:
  - name: "Dan Ostrovsky"
---

# Delegation Toolkit

The following guide teaches you how to use delegations so that users don't see wallet pop-ups when
executing calls to your application.

## Steps

### 1. On-chain wallet support

On-chain wallets will run a security check to ensure your frontend can safely call your canisters on
the user's behalf.

#### Rust implementation

Add the following to each of your backend canisters (and any you deploy dynamically). You should
have one item for every domain that should have authority to call your canisters on behalf of
connected wallets without prompting them with transaction approval messages.

```rust
use candid::{self, CandidType, Deserialize};

#[derive(Clone, Debug, CandidType, Deserialize)]
pub struct Icrc28TrustedOriginsResponse {
    pub trusted_origins: Vec<String>
}

#[update]
fn icrc28_trusted_origins() -> Icrc28TrustedOriginsResponse {
    let trusted_origins = vec![
        String::from("https://your-canister-id.icp0.io"),
        String::from("https://your-canister-id.raw.icp0.io"),
        String::from("https://your-canister-id.ic0.app"),
        String::from("https://your-canister-id.raw.ic0.app"),
        String::from("https://your-canister-id.icp0.icp-api.io"),
        String::from("https://your-canister-id.icp-api.io"),
        String::from("https://yourcustomdomain.com"),
        String::from("https://yourothercustomdomain.com")
    ];

    return Icrc28TrustedOriginsResponse { trusted_origins }
}
```

> Note: ICRC-1, ICRC-7, and other asset canister smart contracts are discouraged from implementing
> this method. Wallets may mark your application as a scam if you do.

Read more about the
[ICRC-28](https://github.com/dfinity/wg-identity-authentication/blob/main/topics/icrc_28_trusted_origins.md)
standard.

### 2. List your canisters as targets

Import `IdentityKitAuthType`, add `authType={IdentityKitAuthType.ACCOUNTS}`, and your list of
`targets` to `IdentityKitProvider`.

```typescript
import { IdentityKitAuthType } from "@nfid/identitykit"

const App = () => {
  return (
    <IdentityKitProvider
      authType={IdentityKitAuthType.DELEGATION}
      targets=["canisterID1", "canisterID2",...]
      {...etc}
    >
      {/* Your App */}
    </IdentityKitProvider>
  );
};
```

### 3. Check Delegation `WIP`

Users will choose whether to continue to your application with a delegation for their main wallet
address or for a wallet address specific to your app's URL. You'll know which you've received:

```typescript
if IdentityKit.connectedWallet.isDelegation {
  if IdentityKit.connectedWallet.delegation.hasTargets {
    // This is an Account Delegation for the user's main wallet address

    // Every transaction to a target canister WILL NOT result in a wallet approval pop-up
    // But every transaction to a non-target-canister WILL

    // Create your own agent when making calls to your own canisters
    // Use the signerAgent from useIdentityKit hook when making calls to other canisters

  } else {
    // This is a Relying Party Delegation for the user's URL-specific wallet address

    // Every transaction to any canister WILL NOT result in a wallet approval pop-up

    // Create your own agent to make calls to any canister
  }
} else {
  // Every transaction WILL result in a wallet approval pop-up

  // Use the signerAgent from useIdentityKit hook when making calls to any canister
}

```

## Resources

Read about the differences working with [accounts and delegations](/miscellaneous/auth-options).
