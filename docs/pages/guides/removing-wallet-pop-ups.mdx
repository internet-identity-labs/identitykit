---
title: "Remove Wallet Pop-ups"
date: "2024-07-10"
authors:
  - name: "Dan Ostrovsky"
---

# Delegation Toolkit

The following guide teaches you how to use delegations so that users don't see wallet pop-ups when
executing calls to your application.

## Steps

### 1. On-chain wallet support

On-chain wallets will run a security check to ensure your frontend can safely call your canisters on the user's behalf.

#### Rust implementation

Add the following to each of your backend canisters (and any you deploy dynamically). You should
have one item for every domain that should have authority to call your canisters on behalf of
connected wallets without prompting them with transaction approval messages.

```rust
#[update]
fn icrc28_trusted_origins() -> Vec<String> {
    return vec![
        String::from("https://your-canister-id.icp0.io"),
        String::from("https://your-canister-id.raw.icp0.io"),
        String::from("https://your-canister-id.ic0.app"),
        String::from("https://your-canister-id.raw.ic0.app"),
        String::from("https://your-canister-id.icp0.icp-api.io"),
        String::from("https://your-canister-id.icp-api.io"),
        String::from("https://yourcustomdomain.com"),
        String::from("https://yourothercustomdomain.com")
    ];
}
```

> Note: ICRC-1, ICRC-7, and other asset canister smart contracts are discouraged from implementing this
method. Wallets may mark your application as a scam if you do.

Read more about the [ICRC-28](https://github.com/dfinity/wg-identity-authentication/blob/main/topics/icrc_28_trusted_origins.md) standard.

### 3. ICRC-10 setup

**SKIP THIS STEP for now**

[ICRC-10](https://github.com/dfinity/ICRC/blob/main/ICRCs/ICRC-10/ICRC-10.md) describes the standard
method for simplifying the discovery of a canister's supported standards on the Internet Computer.

List ICRC-28 and any other standards your canisters support for each of your canisters.

#### Rust implementation

```rust
#[query]
fn icrc10_supported_standards() -> Vec<Record> {
  record { name = "ICRC-10"; url = "https://github.com/dfinity/ICRC/blob/main/ICRCs/ICRC-10/ICRC-10.md"; }
  record { name = "ICRC-28"; url = "https://github.com/dfinity/ICRC/tree/main/ICRCs/ICRC-28/ICRC-28.md"; }
  // list all other supported standards
}
```

### 4. List your canisters as targets

Add `authOption="delegation"` and your list of `targets` to `IdentityKitProvider`.

```typescript
const App = () => {
  return (
    <IdentityKitProvider
      authOption="delegation"
      targets=["canisterID1", "canisterID2",...]
      {...etc}
    >
      {/* Your App */}
    </IdentityKitProvider>
  );
};
```

### 5. Check Delegation

Users will choose whether to continue to your application with a delegation for their main wallet
address or for a wallet address specific to your app's URL. You'll know which you've received:

```typescript
if IdentityKit.connectedWallet.isDelegation {
  if IdentityKit.connectedWallet.delegation.hasTargets {
    // This is an Account Delegation for the user's main wallet address

    // Every transaction to a target canister WILL NOT result in a wallet approval pop-up
    // But every transaction to a non-target-canister WILL

    // Create your own agent when making calls to your own canisters
    // Use the signerAgent from useIdentityKit hook when making calls to other canisters

  } else {
    // This is a Relying Party Delegation for the user's URL-specific wallet address

    // Every transaction to any canister WILL NOT result in a wallet approval pop-up

    // Create your own agent to make calls to any canister
  }
} else {
  // Every transaction WILL result in a wallet approval pop-up

  // Use the signerAgent from useIdentityKit hook when making calls to any canister
}

```

## Resources

Read about the differences working with [accounts and delegations](/miscellaneous/auth-options).
